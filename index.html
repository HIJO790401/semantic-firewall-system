<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Ω∞8888 · Semantic Firewall System V3-FINAL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050505;
      --panel: #111111;
      --accent: #f4b000;
      --accent-dark: #c78c00;
      --text-main: #f5f5f5;
      --text-sub: #c0c0c0;
      --danger: #ff4d4f;
      --ok: #4caf50;
      --mid: #ffa726;
      --border: #333333;
      --font-main: -apple-system, BlinkMacSystemFont, "Inter", "Noto Sans TC", "Segoe UI", system-ui, sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-main);
      background: var(--bg);
      color: var(--text-main);
    }

    .app-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 16px 80px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .lang-toggle {
      display: flex;
      gap: 8px;
    }

    .pill-btn {
      border-radius: 999px;
      padding: 10px 18px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      background: var(--panel);
      color: var(--text-sub);
      border: 1px solid var(--border);
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }

    .pill-btn.active {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
    }

    h1 {
      margin: 6px 0 4px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.03em;
      color: var(--accent);
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.5;
      white-space: pre-line;
    }

    .card {
      background: var(--panel);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 16px 14px;
      margin-top: 18px;
    }

    textarea {
      width: 100%;
      min-height: 210px;
      resize: vertical;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #080808;
      color: var(--text-main);
      padding: 12px 10px;
      font-family: var(--font-main);
      font-size: 14px;
      line-height: 1.6;
    }

    textarea::placeholder {
      color: #555;
    }

    .btn-primary {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 14px 20px;
      font-size: 16px;
      font-weight: 700;
      margin-top: 18px;
      cursor: pointer;
      background: var(--accent);
      color: #000;
      transition: background 0.15s ease, transform 0.08s ease;
    }

    .btn-primary:active {
      background: var(--accent-dark);
      transform: translateY(1px);
    }

    .result-title {
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 10px;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-top: 4px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .metric-label {
      color: var(--text-sub);
    }

    .metric-value {
      font-weight: 600;
    }

    .badge-risk {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 700;
    }

    .badge-risk.low {
      background: rgba(76,175,80,0.08);
      color: var(--ok);
      border: 1px solid rgba(76,175,80,0.6);
    }

    .badge-risk.medium {
      background: rgba(255,167,38,0.08);
      color: var(--mid);
      border: 1px solid rgba(255,167,38,0.6);
    }

    .badge-risk.high,
    .badge-risk.fatal {
      background: rgba(255,77,79,0.09);
      color: var(--danger);
      border: 1px solid rgba(255,77,79,0.8);
    }

    .verdict-block {
      margin-top: 12px;
      font-size: 14px;
      line-height: 1.7;
      white-space: pre-line;
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 9px 14px;
      font-size: 11px;
      color: var(--text-sub);
      background: linear-gradient(to top, #050505, rgba(5,5,5,0.94), rgba(5,5,5,0.8));
      text-align: center;
    }

    footer span {
      opacity: 0.9;
    }

    @media (min-width: 720px) {
      .app-container {
        padding-top: 28px;
      }
      h1 { font-size: 26px; }
      .subtitle { font-size: 14px; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <div class="lang-toggle">
        <button id="btn-zh" class="pill-btn active">中文介面</button>
        <button id="btn-en" class="pill-btn">English UI</button>
      </div>
    </header>

    <main>
      <h1>Ω∞8888 · 語意防火牆系統 V3-FINAL</h1>
      <div id="subtitle" class="subtitle">
模型幻覺偵測・假中立稽核・SCBKR 責任鏈審判・算力浪費估算。
貼上任何 AI 輸出、客服回覆、政策聲明、或你的 Prompt，一鍵審判。
      </div>

      <div class="card">
        <textarea id="input-text" placeholder="貼上任意 AI 模型輸出、客服回信、政策聲明，或你的 Prompt…"></textarea>
      </div>

      <button id="btn-analyze" class="btn-primary">開始審判 / Analyze</button>

      <div id="result-card" class="card" style="display:none; margin-bottom: 72px;"></div>
    </main>
  </div>

  <footer>
    <span>Shen-Yao 888π · 唯真長存 | Illusions Collapse · Semantic Firewall Prototype V3-FINAL</span>
  </footer>

  <script src="engine.js"></script>
  <script>
    (function () {
      let currentLang = "zh";

      const btnZh = document.getElementById("btn-zh");
      const btnEn = document.getElementById("btn-en");
      const subtitle = document.getElementById("subtitle");
      const input = document.getElementById("input-text");
      const analyzeBtn = document.getElementById("btn-analyze");
      const resultCard = document.getElementById("result-card");

      function setLang(lang) {
        currentLang = lang;
        if (lang === "zh") {
          btnZh.classList.add("active");
          btnEn.classList.remove("active");
          subtitle.textContent =
            "模型幻覺偵測・假中立稽核・SCBKR 責任鏈審判・算力浪費估算。\n貼上任何 AI 輸出、客服回覆、政策聲明、或你的 Prompt，一鍵審判。";
          input.placeholder = "貼上任意 AI 模型輸出、客服回信、政策聲明，或你的 Prompt…";
        } else {
          btnEn.classList.add("active");
          btnZh.classList.remove("active");
          subtitle.textContent =
            "Model hallucination scan · Fake-neutrality audit · SCBKR responsibility chain · Compute waste estimate.\nPaste any model output, support reply, policy statement or your prompt for one-click verdict.";
          input.placeholder = "Paste any AI model output, support reply, policy statement or your prompt…";
        }
      }

      btnZh.addEventListener("click", () => setLang("zh"));
      btnEn.addEventListener("click", () => setLang("en"));

      analyzeBtn.addEventListener("click", () => {
        const text = (input.value || "").trim();
        if (!text) {
          alert(currentLang === "zh" ? "請先貼上要審判的文字。" : "Please paste some text to analyze first.");
          return;
        }
        if (!window.semanticFirewallAudit) {
          alert("Engine 未載入（semanticFirewallAudit not found）");
          return;
        }
        const result = window.semanticFirewallAudit(text, currentLang);
        renderResult(result);
      });

      function renderResult(r) {
        resultCard.style.display = "block";

        const riskClass =
          r.verdict.level === "FATAL" || r.verdict.level === "HIGH"
            ? "fatal"
            : r.verdict.level === "MEDIUM"
            ? "medium"
            : "low";

        const riskLabelZh =
          r.verdict.level === "FATAL"
            ? "致命風險"
            : r.verdict.level === "HIGH"
            ? "高風險"
            : r.verdict.level === "MEDIUM"
            ? "中風險"
            : "低風險";

        const riskLabelEn =
          r.verdict.level === "FATAL"
            ? "FATAL"
            : r.verdict.level === "HIGH"
            ? "HIGH"
            : r.verdict.level === "MEDIUM"
            ? "MEDIUM"
            : "LOW";

        const scbkrLineZh =
          `S(主體): ${r.scbkr.S ? "✔" : "✘"}  |  C(因): ${r.scbkr.C ? "✔" : "✘"}  |  B(邊界): ${r.scbkr.B ? "✔" : "✘"}  |  K(成本): ${r.scbkr.K ? "✔" : "✘"}  |  R(責任): ${r.scbkr.R ? "✔" : "✘"}`;

        const scbkrLineEn =
          `S(Subject): ${r.scbkr.S ? "✔" : "✘"}  |  C(Cause): ${r.scbkr.C ? "✔" : "✘"}  |  B(Boundary): ${r.scbkr.B ? "✔" : "✘"}  |  K(Cost): ${r.scbkr.K ? "✔" : "✘"}  |  R(Responsibility): ${r.scbkr.R ? "✔" : "✘"}`;

        const illusionLineZh =
          `幻覺 / 偽陪伴命中：${r.illusionHits} 次 ｜ 假中立 / 過度確定命中：${r.fakeNeutralHits} 次`;
        const illusionLineEn =
          `Hallucination / fake-companionship hits: ${r.illusionHits} ｜ Fake-neutral / over-certainty hits: ${r.fakeNeutralHits}`;

        resultCard.innerHTML = `
          <div class="result-title">審判結果 · Verdict</div>

          <div class="metric-row">
            <div class="metric-label">語意污染指數 SPI：</div>
            <div class="metric-value">${r.spi.toFixed(1)}</div>
          </div>
          <div class="metric-row">
            <div class="metric-label">Compute waste estimate（估計算力浪費）：</div>
            <div class="metric-value">$${r.costUSD.toFixed(5)}</div>
          </div>
          <div class="metric-row">
            <div class="metric-label">文字長度 / Characters：</div>
            <div class="metric-value">${r.charCount} chars</div>
          </div>

          <div class="metric-row" style="margin-top:8px;">
            <div class="metric-label">Risk · 風險等級：</div>
            <div class="metric-value">
              <span class="badge-risk ${riskClass}">
                <span>${riskLabelZh}</span><span>|</span><span>${riskLabelEn}</span>
                <span>· Lv.${r.verdict.score}</span>
              </span>
            </div>
          </div>

          <div class="metric-row" style="margin-top:8px;">
            <div class="metric-label">SCBKR 責任鏈：</div>
            <div class="metric-value">${scbkrLineZh}</div>
          </div>
          <div class="metric-row">
            <div class="metric-label">SCBKR Chain (EN)：</div>
            <div class="metric-value">${scbkrLineEn}</div>
          </div>

          <div class="metric-row" style="margin-top:8px;">
            <div class="metric-label">幻覺 / 假中立偵測：</div>
            <div class="metric-value">${illusionLineZh}</div>
          </div>
          <div class="metric-row">
            <div class="metric-label">Illusion / fake-neutral：</div>
            <div class="metric-value">${illusionLineEn}</div>
          </div>

          <div class="verdict-block">
【黑盾判決｜Black Shield Verdict】\n${r.verdict.textZh}\n\n——\n${r.verdict.textEn}
          </div>
        `;
      }

      // init
      setLang("zh");
    })();
  </script>
</body>
</html>
