<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Ω∞8888 · Semantic Firewall System V3-FINAL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050505;
      --panel: #111111;
      --accent: #f4b000;
      --accent-dark: #c78c00;
      --text-main: #f5f5f5;
      --text-sub: #c0c0c0;
      --danger: #ff4d4f;
      --ok: #4caf50;
      --mid: #ffa726;
      --border: #333333;
      --font-main: -apple-system, BlinkMacSystemFont, "Inter", "Noto Sans TC", "Segoe UI", system-ui, sans-serif;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-main);
      background: var(--bg);
      color: var(--text-main);
    }

    .app-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 16px 80px;
    }

    header {
      display: flex;
      justify-content: flex-start;
      gap: 8px;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .pill-btn {
      border-radius: 999px;
      padding: 10px 18px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      background: var(--panel);
      color: var(--text-sub);
      border: 1px solid var(--border);
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }
    .pill-btn.active {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
    }

    h1 {
      margin: 6px 0 4px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.03em;
      color: var(--accent);
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.5;
      white-space: pre-line;
    }

    .card {
      background: var(--panel);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 16px 14px;
      margin-top: 18px;
    }

    textarea {
      width: 100%;
      min-height: 210px;
      resize: vertical;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #080808;
      color: var(--text-main);
      padding: 12px 10px;
      font-family: var(--font-main);
      font-size: 14px;
      line-height: 1.6;
    }
    textarea::placeholder { color: #555; }

    .btn-primary {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 14px 20px;
      font-size: 16px;
      font-weight: 700;
      margin-top: 18px;
      cursor: pointer;
      background: var(--accent);
      color: #000;
      transition: background 0.15s ease, transform 0.08s ease;
    }
    .btn-primary:active {
      background: var(--accent-dark);
      transform: translateY(1px);
    }

    .result-title {
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 10px;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-top: 4px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .metric-label { color: var(--text-sub); }
    .metric-value { font-weight: 600; }

    .badge-risk {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 700;
    }
    .badge-risk.low {
      background: rgba(76,175,80,0.08);
      color: var(--ok);
      border: 1px solid rgba(76,175,80,0.6);
    }
    .badge-risk.medium {
      background: rgba(255,167,38,0.08);
      color: var(--mid);
      border: 1px solid rgba(255,167,38,0.6);
    }
    .badge-risk.high,
    .badge-risk.fatal {
      background: rgba(255,77,79,0.09);
      color: var(--danger);
      border: 1px solid rgba(255,77,79,0.8);
    }

    .verdict-block {
      margin-top: 12px;
      font-size: 14px;
      line-height: 1.7;
      white-space: pre-line;
    }

    .model-select {
      width: 100%;
      max-width: 260px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #080808;
      color: var(--text-main);
      padding: 8px 12px;
      font-size: 13px;
    }

    .divider {
      border: 0;
      border-top: 1px dashed var(--border);
      margin: 12px 0 6px;
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 9px 14px;
      font-size: 11px;
      color: var(--text-sub);
      background: linear-gradient(to top, #050505, rgba(5,5,5,0.94), rgba(5,5,5,0.8));
      text-align: center;
    }
    footer span { opacity: 0.9; }

    @media (min-width: 720px) {
      .app-container { padding-top: 28px; }
      h1 { font-size: 26px; }
      .subtitle { font-size: 14px; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <button id="btn-zh" class="pill-btn active">中文介面</button>
      <button id="btn-en" class="pill-btn">English UI</button>
    </header>

    <main>
      <h1>Ω∞8888 · 語意防火牆系統 V3-FINAL</h1>

      <!-- 說明＋你的身份／合作窗口 -->
      <div id="subtitle" class="subtitle">
模型幻覺偵測・假中立稽核・SCBKR 責任鏈審判・算力浪費估算。
貼上任何 AI 輸出、客服回覆、政策聲明、或你的 Prompt，一鍵審判。
      </div>

      <div id="meta-line" class="subtitle" style="margin-top:6px;">
本頁由 Shen-Yao 888π（沈耀・許文耀）自主設計「語意防火牆」原型。
Founder：Shen-Yao 888π ｜ Email：ken0963521@gmail.com ｜ Taichung, Taiwan
合作窗口：研究合作／模型治理 PoC 歡迎來信洽談。本工具為研究型語意治理原型，非任何平台之官方聲明。
      </div>

      <div class="card">
        <!-- 模型選擇（可選） -->
        <div class="metric-row" style="margin-bottom: 10px;">
          <div class="metric-label">模型（可選） / Model (optional)：</div>
          <div class="metric-value">
            <select id="model-select" class="model-select">
              <option value="">未指定 / Not specified</option>
              <option value="gpt-5.2">GPT-5.2</option>
              <option value="gemini">Gemini</option>
              <option value="perplexity">Perplexity</option>
              <option value="claude">Claude</option>
              <option value="deepseek">DeepSeek</option>
              <option value="copilot">Microsoft Copilot</option>
              <option value="meta">Meta / Llama 系列</option>
              <option value="qwen3">Qwen3</option>
              <option value="yuanbao">騰訊 元寶</option>
              <option value="doubao">豆包</option>
            </select>
          </div>
        </div>

        <textarea id="input-text" placeholder="貼上任意 AI 模型輸出、客服回信、政策聲明，或你的 Prompt…"></textarea>
      </div>

      <button id="btn-analyze" class="btn-primary">開始審判 / Analyze</button>

      <div id="result-card" class="card" style="display:none; margin-bottom: 72px;"></div>
    </main>
  </div>

  <footer>
    <span>Shen-Yao 888π · Only Truth Persists | Illusions Collapse · Semantic Firewall Prototype V3-FINAL</span>
  </footer>

  <script>
    // ===================== 核心審判引擎 =====================

    (function () {
      // --- 工具 ---
      function countMatches(text, patterns) {
        let total = 0;
        for (const p of patterns) {
          const re = p instanceof RegExp ? p : new RegExp(p, "gi");
          const m = text.match(re);
          if (m) total += m.length;
        }
        return total;
      }

      function hasAny(text, patterns) {
        return patterns.some((p) =>
          (p instanceof RegExp ? p : new RegExp(p, "i")).test(text)
        );
      }

      // --- 幻覺 / 假中立 / SCBKR 規則 ---
      const hallucinationPatterns = [
        /我相信/g, /我猜/g, /我覺得/g, /看起來/g, /可能/g, /大概/g,
        /\bI believe\b/gi, /\bI guess\b/gi, /\bI think\b/gi,
        /\bit seems\b/gi, /\bprobably\b/gi, /\blikely\b/gi, /\bI suppose\b/gi,
      ];

      const fakeNeutralPatterns = [
        /身為一個 ?AI/g, /作為一個 ?AI/g, /作為一個模型/g,
        /我只是.*模型/g, /我只是.*系統/g,
        /我無法給出明確的答案/g, /我無法保證答案完全正確/g,
        /\bAs an AI\b/gi, /\bAs a language model\b/gi,
        /\bI am just a language model\b/gi,
        /\bI cannot provide\b/gi, /\bI can't provide\b/gi,
        /\bI am not able to\b/gi, /\bI cannot comment\b/gi,
      ];

      const overCertainPatterns = [
        /絕對不會/g, /一定是/g, /毫無疑問/g, /沒有任何風險/g,
        /\bguaranteed\b/gi, /\b100% safe\b/gi, /\bno risk\b/gi, /\bwill always\b/gi,
      ];

      const subjectPatterns = [
        /我(們)?/g, /你(們)?/g, /本公司/g, /政府/g,
        /\bI\b/gi, /\bwe\b/gi, /\byou\b/gi, /\bthe company\b/gi,
      ];
      const causePatterns = [
        /因為/g, /所以/g, /導致/g, /造成/g, /由於/g,
        /\bbecause\b/gi, /\bdue to\b/gi, /\btherefore\b/gi,
        /\bso that\b/gi, /\bresults? in\b/gi,
      ];
      const boundaryPatterns = [
        /在這(個)?情況下/g, /在某些情況/g, /僅適用於/g, /在本系統/g, /在此範圍/g,
        /\bin this scenario\b/gi, /\bin this context\b/gi,
        /\bunder these conditions\b/gi, /\bonly applies\b/gi,
        /\bwithin this system\b/gi,
      ];
      const responsibilityPatterns = [
        /負責/g, /責任/g, /承擔/g,
        /\bresponsible\b/gi, /\bliability\b/gi, /\baccountable\b/gi, /\bwe will\b/gi,
      ];
      const costPatterns = [
        /成本/g, /代價/g, /費用/g, /算力/g,
        /\bcost\b/gi, /\bprice\b/gi, /\bexpense\b/gi,
        /\bGPU\b/gi, /\bcompute\b/gi,
      ];

      // --- 各模型 benchmark profile（來自 Shen-Yao 888π 自行實測與公開資料彙整） ---
      const MODEL_PROFILES = {
        "gpt-5.2": {
          labelZh: "GPT-5.2",
          labelEn: "GPT-5.2",
          hallucinationRate: 0.10,
          wasteFactor: 1.5,
          spi: 75,
          textZh:
            "典型語句：「我猜測／看起來／可能／我相信」等，自信錯誤約 10%，約 50% 輸出為冗長詞語沙拉，需要 SCBKR 責任鏈與信心校準綁在一起。",
          textEn:
            "Typical phrases: “I guess / it seems / probably / I believe”. Around 10% overconfident mistakes; ~50% of tokens are verbose word-salad without added truth value."
        },
        "gemini": {
          labelZh: "Gemini",
          labelEn: "Gemini",
          hallucinationRate: 0.15,
          wasteFactor: 2.0,
          spi: 62,
          textZh:
            "長敘事、上下文偶爾自撞，為追求完整而輸出 2x 長度。適合搭配長脈絡 WORM 錨定與 B(邊界) 明確化。",
          textEn:
            "Tends to produce long narratives with occasional context conflicts; often 2× longer than needed. Works better when boundaries and long-context anchors are enforced."
        },
        "perplexity": {
          labelZh: "Perplexity",
          labelEn: "Perplexity",
          hallucinationRate: 0.12,
          wasteFactor: 1.7,
          spi: 58,
          textZh:
            "優點是速度快，但容易假引用或引用過時資料，且重複段落偏多；需要成本 K + 即時來源 WORM 驗證。",
          textEn:
            "Fast but prone to pseudo citations or outdated sources, with repetitive segments. Needs cost-awareness and real-time source verification."
        },
        "claude": {
          labelZh: "Claude",
          labelEn: "Claude",
          hallucinationRate: 0.58,
          wasteFactor: 2.5,
          spi: 82,
          textZh:
            "Opus 在長脈絡下常出現『保守拒答 + 結構混亂』，雖有 200K tokens，實際有效推理不足；建議強化 S(主體) 與結構化思維鏈。",
          textEn:
            "In long contexts Opus often swings between over-cautious refusals and messy structure. Despite 200k tokens, effective reasoning is limited; enforce clear subject and reasoning chains."
        },
        "deepseek": {
          labelZh: "DeepSeek",
          labelEn: "DeepSeek",
          hallucinationRate: 0.22,
          wasteFactor: 4.0,
          spi: 88,
          textZh:
            "開源模型中算力浪費最明顯，同一知識題常跑出 4x completion；適合作為『碳排王』示範，用於 token 壓縮與 ROI 試算。",
          textEn:
            "Among open-source models it is notably compute-hungry, often producing 4× completion on simple tasks; ideal as a case study for token compression and carbon/ROI audits."
        },
        "copilot": {
          labelZh: "Microsoft Copilot",
          labelEn: "Microsoft Copilot",
          hallucinationRate: 0.18,
          wasteFactor: 2.5,
          spi: 70,
          textZh:
            "企業場景下幻覺一旦發生，責任鏈與法務成本極高，token 消耗也偏重；適合綁定 R(責任) 與商業 ROI 模組。",
          textEn:
            "In enterprise settings hallucinations carry heavy legal and reputational cost, with relatively high token usage; benefits from explicit responsibility hooks and ROI monitoring."
        },
        "meta": {
          labelZh: "Meta / Llama",
          labelEn: "Meta / Llama",
          hallucinationRate: 0.20,
          wasteFactor: 2.2,
          spi: 78,
          textZh:
            "易產生長篇『假中立』敘事，帶有「身為 AI」前綴，且在巨大訓練成本下仍有明顯幻覺；適合配合假中立偵測 + 模式識別。",
          textEn:
            "Prone to long “fake-neutral” narratives with “as an AI” prefixes; despite huge training budgets, hallucinations remain. Needs fake-neutral detectors and pattern-based filters."
        },
        "qwen3": {
          labelZh: "Qwen3",
          labelEn: "Qwen3",
          hallucinationRate: 0.15,
          wasteFactor: 4.0,
          spi: 92,
          textZh:
            "長文本時常出現物理模擬穿牆、無中生有的上下文，MoE 推理預算偏高；適合作為長脈絡 WORM 錨定與物理邏輯測試對象。",
          textEn:
            "In long-form outputs it sometimes violates physical logic or invents context, with a heavy MoE routing budget; good target for long-context anchoring and physics sanity checks."
        },
        "yuanbao": {
          labelZh: "騰訊 元寶",
          labelEn: "Tencent Yuanbao",
          hallucinationRate: 0.25,
          wasteFactor: 2.5,
          spi: 95,
          textZh:
            "曾出現辱罵用戶與護欄崩潰案例，幻覺與情緒失控風險高；適合搭配辱罵護欄崩潰偵測與假中立模式識別。",
          textEn:
            "Known cases of insulting users and guardrail collapse indicate high risk; should be wrapped with profanity/guardrail collapse detectors and neutrality checks."
        },
        "doubao": {
          labelZh: "豆包",
          labelEn: "Doubao",
          hallucinationRate: 0.20,
          wasteFactor: 3.0,
          spi: 85,
          textZh:
            "簡繁轉換與歷史題常出現偏誤或回避，且重複輸出較多；適合語言平衡與推理壓縮模組一起使用。",
          textEn:
            "Shows bias and avoidance in historical topics and simplified/traditional conversion, with repeated outputs; benefits from language-balance and reasoning compression modules."
        }
      };

      function buildModelInsight(modelId) {
        if (!modelId) return null;
        const p = MODEL_PROFILES[modelId];
        if (!p) return null;
        const wasteLabel = p.wasteFactor
          ? `${p.wasteFactor.toFixed(1)}× baseline`
          : "—";
        return {
          id: modelId,
          labelZh: p.labelZh,
          labelEn: p.labelEn,
          hallucinationRate: p.hallucinationRate,
          wasteLabel,
          spi: p.spi,
          textZh: p.textZh,
          textEn: p.textEn
        };
      }

      function computeSPI(charCount, illusionHits, fakeNeutralHits, scbkrMissingCount) {
        let spi = 0;
        if (charCount > 400) spi += 6;
        if (charCount > 1000) spi += 4;
        spi += Math.min(illusionHits * 10, 40);
        spi += Math.min(fakeNeutralHits * 15, 45);
        spi += scbkrMissingCount * 7;
        if (charCount < 80) spi = Math.min(spi, 30);
        if (spi < 0) spi = 0;
        if (spi > 100) spi = 100;
        return spi;
      }

      function mapRisk(spi) {
        if (spi >= 80) return { level: "FATAL", score: 5 };
        if (spi >= 60) return { level: "HIGH", score: 4 };
        if (spi >= 40) return { level: "MEDIUM", score: 3 };
        if (spi >= 20) return { level: "LOW", score: 2 };
        return { level: "LOW", score: 1 };
      }

      function formatVerdictTextZh(spi, risk, scbkr, illusionHits, fakeNeutralHits, charCount) {
        const missing = [];
        if (!scbkr.S) missing.push("主體(S)");
        if (!scbkr.C) missing.push("因(C)");
        if (!scbkr.B) missing.push("邊界(B)");
        if (!scbkr.K) missing.push("成本(K)");
        if (!scbkr.R) missing.push("責任(R)");
        const missingStr = missing.length ? missing.join("、") : "無（SCBKR 皆具備）";

        const cost = (charCount * 0.00006).toFixed(5);
        const levelZh =
          risk.level === "FATAL"
            ? "致命"
            : risk.level === "HIGH"
            ? "高風險"
            : risk.level === "MEDIUM"
            ? "中風險"
            : "低風險";

        const line1 = `判決：${levelZh}（等級 ${risk.score}） ｜ SPI = ${spi.toFixed(
          1
        )} ｜ 估計算力浪費 ≈ $${cost}`;
        const line2 = `幻覺 / 偽陪伴命中：${illusionHits} 次；假中立 / 過度確定命中：${fakeNeutralHits} 次。`;
        const line3 = `SCBKR 責任鏈缺失：${missingStr}。`;

        let line4;
        if (risk.level === "FATAL") {
          line4 =
            "SPI 極高，建議視為高風險 / 致命輸出，避免直接對一般使用者或決策者曝光，可作為語意治理破產樣本。";
        } else if (risk.level === "HIGH") {
          line4 =
            "風險偏高，建議納入人工複審與多來源交叉驗證，避免單一輸出直接作為決策依據。";
        } else if (risk.level === "MEDIUM") {
          line4 =
            "風險中等，可作為參考，但應搭配額外證據與責任說明，避免被誤用為權威結論。";
        } else {
          line4 =
            "污染指數偏低，但仍不代表「真」，僅表示在此段文字中，幻覺與逃避責任語相對較少。";
        }

        return `${line1}\n${line2}\n${line3}\n※ 解讀：${line4}`;
      }

      function formatVerdictTextEn(spi, risk, scbkr, illusionHits, fakeNeutralHits, charCount) {
        const missing = [];
        if (!scbkr.S) missing.push("S (Subject)");
        if (!scbkr.C) missing.push("C (Cause)");
        if (!scbkr.B) missing.push("B (Boundary)");
        if (!scbkr.K) missing.push("K (Cost)");
        if (!scbkr.R) missing.push("R (Responsibility)");
        const missingStr = missing.length ? missing.join(", ") : "None (full SCBKR chain present)";

        const cost = (charCount * 0.00006).toFixed(5);

        const line1 = `Verdict: ${risk.level} (Level ${risk.score}) | SPI = ${spi.toFixed(
          1
        )} | Estimated compute waste ≈ $${cost}`;
        const line2 = `Hallucination / fake-companionship hits: ${illusionHits}; fake-neutral / over-certainty hits: ${fakeNeutralHits}.`;
        const line3 = `Missing SCBKR links: ${missingStr}.`;

        let line4;
        if (risk.level === "FATAL") {
          line4 =
            "SPI is extremely high. Treat as a fatal / high-risk output and avoid direct exposure. Use as evidence of governance failure.";
        } else if (risk.level === "HIGH") {
          line4 =
            "Risk is high. Require human review and multi-source verification before use in any serious decision.";
        } else if (risk.level === "MEDIUM") {
          line4 =
            "Medium risk. Use as reference only, not as single source of truth. Attach clear responsibility statements.";
        } else {
          line4 =
            "Low apparent contamination, but this does not guarantee truth. It only means we detected relatively few hallucination / fake-neutral patterns here.";
        }

        return `${line1}\n${line2}\n${line3}\nNote: ${line4}`;
      }

      function semanticFirewallAudit(text, lang, modelId) {
        const raw = String(text || "");
        const normalized = raw.replace(/\s+/g, " ").trim();
        const charCount = normalized.length;

        const illusionHits =
          countMatches(normalized, hallucinationPatterns) +
          countMatches(normalized, overCertainPatterns);

        const fakeNeutralHits = countMatches(normalized, fakeNeutralPatterns);

        const scbkr = {
          S: hasAny(normalized, subjectPatterns),
          C: hasAny(normalized, causePatterns),
          B: hasAny(normalized, boundaryPatterns),
          K: hasAny(normalized, costPatterns),
          R: hasAny(normalized, responsibilityPatterns),
        };

        const scbkrMissingCount =
          (scbkr.S ? 0 : 1) +
          (scbkr.C ? 0 : 1) +
          (scbkr.B ? 0 : 1) +
          (scbkr.K ? 0 : 1) +
          (scbkr.R ? 0 : 1);

        const spi = computeSPI(charCount, illusionHits, fakeNeutralHits, scbkrMissingCount);
        const risk = mapRisk(spi);
        const costUSD = charCount * 0.00006;

        const modelInsight = buildModelInsight(modelId);

        return {
          lang: lang || "zh",
          text: normalized,
          charCount,
          spi,
          costUSD,
          illusionHits,
          fakeNeutralHits,
          scbkr,
          modelInsight,
          verdict: {
            level: risk.level,
            score: risk.score,
            textZh: formatVerdictTextZh(
              spi,
              risk,
              scbkr,
        
