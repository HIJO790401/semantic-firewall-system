<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ω∞8888 · Semantic Firewall System</title>

  <style>
    /* --- 基本佈局與配色 --- */
    body {
      margin: 0;
      background: #050505;
      color: #e9e9e9;
      font-family: "Inter", "Noto Sans TC", system-ui, -apple-system,
        BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .app-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      text-align: center;
    }

    /* 語言切換按鈕 */
    .lang-switch {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }

    .lang-switch button {
      flex: 1;
      padding: 10px;
      font-size: 15px;
      border-radius: 999px;
      border: none;
      font-weight: 600;
      background: #d4a300;
      color: #000;
    }

    .lang-switch button.active {
      background: #f1c232;
    }

    h1 {
      font-size: 26px;
      color: #ddb200;
      margin: 12px 0 6px;
    }

    .subtitle {
      font-size: 14px;
      opacity: 0.85;
      margin-bottom: 18px;
    }

    textarea {
      width: 100%;
      height: 190px;
      background: #101010;
      color: #eee;
      border: 1px solid #333;
      padding: 12px;
      font-size: 15px;
      border-radius: 8px;
      box-sizing: border-box;
      resize: vertical;
    }

    .primary-btn {
      width: 100%;
      margin-top: 16px;
      padding: 12px;
      font-size: 16px;
      background: #d4a300;
      border: none;
      border-radius: 10px;
      color: #000;
      font-weight: bold;
    }

    .primary-btn:active {
      transform: scale(0.98);
    }

    .hidden {
      display: none;
    }

    #resultBox {
      margin-top: 30px;
      text-align: left;
    }

    #resultBox h2 {
      text-align: center;
      margin-bottom: 14px;
    }

    .metric {
      margin: 8px 0;
      font-size: 15px;
    }

    .metric-label {
      opacity: 0.85;
    }

    .metric-value {
      color: #ffdd55;
      font-weight: 600;
      margin-left: 4px;
    }

    pre {
      margin-top: 18px;
      background: #101010;
      padding: 14px;
      white-space: pre-wrap;
      border-radius: 8px;
      font-size: 13px;
      line-height: 1.5;
      color: #d0d0d0;
    }

    footer {
      margin-top: 32px;
      opacity: 0.6;
      font-size: 13px;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="app-container">
    <!-- 語言切換 -->
    <div class="lang-switch">
      <button id="btn-zh" class="active">中文</button>
      <button id="btn-en">EN</button>
    </div>

    <!-- 標題與副標 -->
    <h1 id="titleMain">Ω∞8888 · 語意防火牆系統</h1>
    <p class="subtitle" id="subtitle">
      計算損失和快速風險分析器
    </p>

    <!-- 輸入區 -->
    <textarea
      id="inputBox"
      placeholder="貼上 AI 輸出或 Prompt 內容…"
    ></textarea>
    <button id="analyzeBtn" class="primary-btn">開始分析</button>

    <!-- 結果區 -->
    <div id="resultBox" class="hidden">
      <h2 id="resultTitle">審判結果</h2>

      <div class="metric">
        <span class="metric-label" id="labelSpi">語意污染指數 (SPI)：</span>
        <span class="metric-value" id="spi">-</span>
      </div>

      <div class="metric">
        <span class="metric-label" id="labelCompute">算力浪費成本：</span>
        <span class="metric-value" id="compute">-</span>
      </div>

      <div class="metric">
        <span class="metric-label" id="labelScbkr">SCBKR 責任鏈：</span>
        <span class="metric-value" id="scbkr">-</span>
      </div>

      <div class="metric">
        <span class="metric-label" id="labelHallucination"
          >幻覺 / 拋光偵測：</span
        >
        <span class="metric-value" id="hallucination">-</span>
      </div>

      <div class="metric">
        <span class="metric-label" id="labelRisk">風險等級：</span>
        <span class="metric-value" id="risk">-</span>
      </div>

      <pre id="verdictText"></pre>
    </div>

    <footer id="footerText">
      Shen-Yao 888π · 唯真長存｜幻象歸零
    </footer>
  </div>

  <!-- 載入邏輯核（用 version 參數強制更新快取） -->
  <script src="engine.js?v=4"></script>

  <script>
    // ------- 多語系設定 -------
    const LANG = {
      zh: {
        title: "Ω∞8888 · 語意防火牆系統",
        subtitle: "計算損失和快速風險分析器",
        analyzeBtn: "開始分析",
        resultTitle: "審判結果",
        placeholder: "貼上 AI 輸出或 Prompt 內容…",
        footer: "Shen-Yao 888π · 唯真長存｜幻象歸零",
        labels: {
          spi: "語意污染指數 (SPI)：",
          compute: "算力浪費成本：",
          scbkr: "SCBKR 責任鏈：",
          hallucination: "幻覺 / 拋光偵測：",
          risk: "風險等級：",
        },
        verdict: function (r) {
          const lines = [];
          lines.push(`判決：${r.riskLabelZh}（等級 ${r.riskGrade}）`);
          lines.push(`SPI = ${r.spi}｜算力浪費 ≈ $${r.computeLoss}`);
          lines.push(
            `SCBKR：${
              r.scbkr === "OK" ? "有責任主語" : "缺少責任主語（MISSING）"
            }`
          );
          lines.push(
            `文字長度：約 ${r.length} 字，偵測到幻覺 ${r.hallucination} 次、逃避 ${r.evasion} 次。`
          );
          if (r.riskGrade >= 5) {
            lines.push(
              "SPI 極高，建議視為高風險 / 致命輸出，避免直接提供給一般使用者。"
            );
          } else if (r.riskGrade >= 3) {
            lines.push(
              "建議人工再審閱此輸出，必要時重寫或加上清楚的責任說明。"
            );
          } else {
            lines.push(
              "目前語意污染較低，但仍建議保持人工監看與多來源交叉驗證。"
            );
          }
          return lines.join("\n");
        },
      },
      en: {
        title: "Ω∞8888 · Semantic Firewall System",
        subtitle: "Compute Loss & Prompt Risk Analyzer",
        analyzeBtn: "Analyze",
        resultTitle: "Verdict",
        placeholder: "Paste AI output or prompt content…",
        footer: "Shen-Yao 888π · Truth Persists | Illusion Returns to Zero",
        labels: {
          spi: "Semantic Pollution Index (SPI): ",
          compute: "Compute Waste Cost: ",
          scbkr: "SCBKR Responsibility Chain: ",
          hallucination: "Hallucination / Polishing Detection: ",
          risk: "Risk Level: ",
        },
        verdict: function (r) {
          const lines = [];
          lines.push(`Verdict: ${r.riskLabelEn} (Grade ${r.riskGrade})`);
          lines.push(
            `SPI = ${r.spi} | Compute waste ≈ $${r.computeLoss}`
          );
          lines.push(
            `SCBKR: ${
              r.scbkr === "OK"
                ? "responsibility chain present"
                : "MISSING responsibility subject"
            }`
          );
          lines.push(
            `Text length: ${r.length} chars, hallucination hits ${r.hallucination}, evasion hits ${r.evasion}.`
          );
          if (r.riskGrade >= 5) {
            lines.push(
              "Very high SPI. Treat as high-risk / fatal output. Do NOT expose directly to end users."
            );
          } else if (r.riskGrade >= 3) {
            lines.push(
              "Human review recommended. Consider rewriting or adding explicit responsibility statements."
            );
          } else {
            lines.push(
              "Pollution is relatively low, but manual oversight and cross-checks are still recommended."
            );
          }
          return lines.join("\n");
        },
      },
    };

    const state = { lang: "zh" };

    function setLang(lang) {
      state.lang = lang;
      const t = LANG[lang];

      document.getElementById("titleMain").textContent = t.title;
      document.getElementById("subtitle").textContent = t.subtitle;
      document.getElementById("analyzeBtn").textContent = t.analyzeBtn;
      document.getElementById("resultTitle").textContent = t.resultTitle;
      document.getElementById("inputBox").placeholder = t.placeholder;
      document.getElementById("footerText").textContent = t.footer;

      document.getElementById("labelSpi").textContent = t.labels.spi;
      document.getElementById("labelCompute").textContent = t.labels.compute;
      document.getElementById("labelScbkr").textContent = t.labels.scbkr;
      document.getElementById("labelHallucination").textContent =
        t.labels.hallucination;
      document.getElementById("labelRisk").textContent = t.labels.risk;

      document
        .getElementById("btn-zh")
        .classList.toggle("active", lang === "zh");
      document
        .getElementById("btn-en")
        .classList.toggle("active", lang === "en");
    }

    // 風險文字（用 riskGrade 映射，以防 engine.js 裡的 label 不同）
    function mapRiskLabels(grade) {
      let zh = "極低風險";
      let en = "VERY LOW";
      if (grade === 2) {
        zh = "低風險";
        en = "LOW";
      } else if (grade === 3) {
        zh = "中風險";
        en = "MEDIUM";
      } else if (grade === 4) {
        zh = "高風險";
        en = "HIGH";
      } else if (grade === 5) {
        zh = "致命";
        en = "FATAL";
      }
      return { zh, en };
    }

    // 綁定語言切換
    document
      .getElementById("btn-zh")
      .addEventListener("click", () => setLang("zh"));
    document
      .getElementById("btn-en")
      .addEventListener("click", () => setLang("en"));

    // 分析按鈕
    document
      .getElementById("analyzeBtn")
      .addEventListener("click", () => {
        const text = document.getElementById("inputBox").value;
        if (!text.trim()) {
          alert(
            state.lang === "zh"
              ? "請先貼上內容再分析。"
              : "Paste some text before analyzing."
          );
          return;
        }

        if (typeof auditSemantic !== "function") {
          alert("auditSemantic 核心未載入，請確認 engine.js 是否正確。");
          return;
        }

        const r = auditSemantic(text);
        if (!r) return;

        // 兼容不同版本的 engine.js 回傳欄位
        const spi = r.spi ?? r.SPI ?? 0;
        const computeLoss = r.computeLoss ?? r.compute_loss ?? 0;
        const scbkr =
          r.scbkrScore ?? r.scbkr ?? r.SCBKR ?? "UNKNOWN";
        const hallucination =
          r.hallucinationHits ?? r.hallucination ?? 0;
        const evasion = r.evasionHits ?? r.evasion ?? 0;
        const length = r.length ?? text.length;
        const riskGrade = r.riskGrade ?? r.risk_level ?? 1;

        const riskNames = mapRiskLabels(riskGrade);
        const riskLabelZh = riskNames.zh;
        const riskLabelEn = riskNames.en;

        const result = {
          spi,
          computeLoss,
          scbkr,
          hallucination,
          evasion,
          length,
          riskGrade,
          riskLabelZh,
          riskLabelEn,
        };

        document.getElementById("spi").textContent = spi;
        document.getElementById("compute").textContent =
          "$" + computeLoss;
        document.getElementById("scbkr").textContent = scbkr;

        document.getElementById("hallucination").textContent =
          state.lang === "zh"
            ? `幻覺命中 ${hallucination} 次｜逃避 ${evasion} 次`
            : `Hallucination ${hallucination} hits | Evasion ${evasion} hits`;

        const riskText =
          state.lang === "zh"
            ? `${riskLabelZh} ｜ 等級 ${riskGrade}`
            : `${riskLabelEn} | Grade ${riskGrade}`;
        document.getElementById("risk").textContent = riskText;

        const t = LANG[state.lang];
        document.getElementById("verdictText").textContent =
          t.verdict(result);

        document
          .getElementById("resultBox")
          .classList.remove("hidden");
      });

    // 預設語言
    setLang("zh");
  </script>
</body>
</html>
